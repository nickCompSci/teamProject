!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexquadimageplugin=t()}(void 0,function(){function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=s(n);if(r){var i=s(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}(this,e)}}function f(){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}}).apply(this,arguments)}function e(e,t,i){var n=e.width/2,r=e.height/2;return v.x=t-n,v.y=i-r,d(v,0,0,e.rotation),v.x*=e.scaleX,v.y*=e.scaleY,v.x+=e.x,v.y+=e.y,v}var d=Phaser.Math.RotateAround,v={x:0,y:0},y=function(){function i(e,t){c(this,i),this.parent=e,this.vertex=t,this._localX=void 0,this._localY=void 0}return r(i,[{key:"destroy",value:function(){this.parent=void 0,this.vertex=void 0}},{key:"updateVertexPosition",value:function(e,t){var i=this.parent,n=i.height,r=e/n-i.frame.cutWidth/n/2,o=t/n-i.frame.cutHeight/n/2,s=this.vertex;return s.x=r,s.y=-o,i.forceUpdate(),this}},{key:"localX",get:function(){return this._localX},set:function(e){this.setLocalXY(e,this._localY)}},{key:"localY",get:function(){return this._localY},set:function(e){this.setLocalXY(this._localX,e)}},{key:"localXOrigin",get:function(){return this._localXOrigin}},{key:"localYOrigin",get:function(){return this._localYOrigin}},{key:"resetLocalXY",value:function(e,t){return this._localXOrigin=e,this._localYOrigin=t,this._localX=e,this._localY=t,this}},{key:"setLocalXY",value:function(e,t,i){return this._localX===e&&this._localY===t||(this._localX=e,this._localY=t,i||this.updateVertexPosition(e,t)),this}},{key:"setWorldXY",value:function(e,t){if(this._worldX===e&&this._worldY===t)return this;var i,n,r,o,s,a=(i=this.parent,n=e,r=t,o=i.width/2,s=i.height/2,v.x=n-i.x,v.y=r-i.y,v.x/=i.scaleX,v.y/=i.scaleY,d(v,0,0,-i.rotation),v.x+=o,v.y+=s,v);return this.setLocalXY(a.x,a.y),this}},{key:"setPosition",value:function(e,t){return this.setWorldXY(e,t),this}},{key:"getWorldXY",value:function(){return e(this.parent,this._localX,this._localY)}},{key:"x",get:function(){return e(this.parent,this._localX,this._localY).x},set:function(e){this.setWorldXY(e,this.y)}},{key:"y",get:function(){return e(this.parent,this._localX,this._localY).y},set:function(e){this.setWorldXY(this.x,e)}}]),i}(),g=Phaser.Geom.Mesh.Vertex,p=Phaser.Geom.Mesh.Face,w=[0,2,3,0,3,1],x=[1,3,2,1,2,0],b=[0,3,4,0,4,1,1,4,2,4,5,2,3,6,4,6,7,4,4,7,8,4,8,5],t=Phaser.GameObjects.Mesh,m=Phaser.Utils.Objects.IsPlainObject,k=Phaser.Utils.Objects.GetValue,P=function(){o(u,t);var a=l(u);function u(e,t,i,n,r,o){var s;return c(this,u),m(t)&&(t=k(o=t,"x",0),i=k(o,"y",0),n=k(o,"key",null),r=k(o,"frame",null)),(s=a.call(this,e,t,i,n,r)).type="rexQuadImage",s.isNinePointMode=k(o,"ninePointMode",!1),s.fourPointsModeRTL=k(o,"rtl",!1),s.controlPoints=[],function(e){for(var t,i=e.isNinePointMode,n=i?9:4,r=e.vertices,o=e.faces,s=e.controlPoints,a=0;a<n;a++){var u=new g;r.push(u),s.push(new y(e,u))}a=0;for(var h=(t=i?b:e.fourPointsModeRTL?x:w).length;a<h;a+=3){var c=r[t[a+0]],l=r[t[a+1]],f=r[t[a+2]];o.push(new p(c,l,f))}i?(e.topLeft=s[0],e.topCenter=s[1],e.topRight=s[2],e.centerLeft=s[3],e.center=s[4],e.centerRight=s[5],e.bottomLeft=s[6],e.bottomCenter=s[7],e.bottomRight=s[8]):(e.topLeft=s[0],e.topRight=s[1],e.bottomLeft=s[2],e.bottomRight=s[3])}(h(s)),s.hideCCW=!1,s.syncSize(),s}return r(u,[{key:"preDestroy",value:function(){for(var e=0,t=this.controlPoints.length;e<t;e++)this.controlPoints[e].destroy();this.controlPoints=void 0,f(s(u.prototype),"preDestroy",this).call(this)}},{key:"resetVerts",value:function(){this.dirtyCache[9]=-1;for(var e=function(e){var t,i=e.height,n=e.width;if(e.isNinePointMode){var r=(0+n)/2,o=(0+i)/2;t=[0,0,r,0,n,0,0,o,r,o,n,o,0,i,r,i,n,i]}else t=[0,0,n,0,0,i,n,i];return t}(this),t=this.width,i=this.height,n=this.frame.cutWidth/i/2,r=this.frame.cutHeight/i/2,o=this.frame.source.isRenderTexture,s=this.frame.u0,a=this.frame.u1,u=o?this.frame.v1:this.frame.v0,h=a-s,c=(o?this.frame.v0:this.frame.v1)-u,l=this.controlPoints,f=0,d=e.length;f<d;f+=2){var v=e[f+0],y=e[f+1],g=f/2,p=v/i-n,w=y/i-r,x=s+v/t*h,b=u+y/i*c;this.vertices[g].set(p,-w,0).setUVs(x,b),l[g].resetLocalXY(v,y)}return this}},{key:"syncSize",value:function(){return this.setSizeToFrame(),this.setOrtho(this.width/this.height,1),this.resetVerts(),this}},{key:"forceUpdate",value:function(){return this.dirtyCache[10]=1,this}},{key:"tint",get:function(){return 0===this.vertices.length?16777215:this.vertices[0].color},set:function(e){for(var t=this.vertices,i=0,n=t.length;i<n;i++)t[i].color=e}},{key:"setTint",value:function(e){return this.tint=e,this}}]),u}();function a(e,t,i,n,r){var o=new P(this.scene,e,t,i,n,r);return this.scene.add.existing(o),o}var O=Phaser.Utils.Objects.GetAdvancedValue,j=Phaser.GameObjects.BuildGameObject;function X(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=O(e,"key",null),n=O(e,"frame",null),r=new P(this.scene,0,0,i,n,e);return j(this.scene,r,e),r}function Y(e){return void 0!==e.displayWidth?e.displayWidth:e.width}function R(e){return void 0!==e.displayHeight?e.displayHeight:e.height}function _(e,t){if(void 0===t?t=new M:!0===t&&(void 0===B&&(B=new M),t=B),e.getBounds)return e.getBounds(t);var i,n,r,o,s,a,u,h;if(e.parentContainer){var c=e.parentContainer.getBoundsTransformMatrix();L(e,t),c.transformPoint(t.x,t.y,t),i=t.x,n=t.y,U(e,t),c.transformPoint(t.x,t.y,t),r=t.x,o=t.y,D(e,t),c.transformPoint(t.x,t.y,t),s=t.x,a=t.y,I(e,t),c.transformPoint(t.x,t.y,t),u=t.x,h=t.y}else L(e,t),i=t.x,n=t.y,U(e,t),r=t.x,o=t.y,D(e,t),s=t.x,a=t.y,I(e,t),u=t.x,h=t.y;return t.x=Math.min(i,r,s,u),t.y=Math.min(n,o,a,h),t.width=Math.max(i,r,s,u)-t.x,t.height=Math.max(n,o,a,h)-t.y,t}function G(e,t){var i=Array.isArray(e);if(void 0===t?t=i?[]:{}:function(e){if("object"!==u(e)||null===e)return;if(Array.isArray(e))e.length=0;else for(var t in e)delete e[t]}(t),i){t.length=e.length;for(var n=0,r=e.length;n<r;n++)t[n]=e[n]}else for(var o in e)t[o]=e[o];return t}function T(e){if(e){var t,i,n=e.gameObjects,r=e.renderTexture,o=Q(e,"x",void 0),s=Q(e,"y",void 0),a=Q(e,"width",void 0),u=Q(e,"height",void 0),h=Q(e,"originX",0),c=Q(e,"originY",0),l=Q(e,"padding",0);if(void 0===a||void 0===u||void 0===o||void 0===s){var f=function(e,t){var i;void 0===t?t=new z:!0===t&&(void 0===S&&(S=new z),t=S),t.setTo(0,0,0,0);for(var n=!0,r=0,o=e.length;r<o;r++)if((i=e[r]).getBounds){var s=_(i,!0);n?(t.setTo(s.x,s.y,s.width,s.height),n=!1):H(s,t,t)}return t}(n,!0);c=h=void 0!==o&&void 0!==s?(a=2*Math.max(o-f.left,f.right-o),u=2*Math.max(s-f.top,f.bottom-s),.5):(o=f.x,s=f.y,a=f.width,u=f.height,0),t=f.x,i=f.y}else t=o+(0-h)*a,i=s+(0-c)*u;t-=l,i-=l,a+=2*l,u+=2*l;var d=!r;if(d)r=n[0].scene.add.renderTexture(0,0,a,u);r.setPosition(o,s),r.width===a&&r.height===u||r.setSize(a,u),r.setOrigin(h,c),r.camera.setScroll(t,i),n=function(e,t){if(0===e.length)return e;void 0===t&&(t=!1);var i=e[0].scene.sys.displayList;return i.depthSort(),t?e.sort(function(e,t){return i.getIndex(t)-i.getIndex(e)}):e.sort(function(e,t){return i.getIndex(e)-i.getIndex(t)}),e}(G(n)),r.draw(n);var v=e.saveTexture;return v&&r.saveTexture(v),d&&v&&r.destroy(),r}}var S,M=Phaser.Geom.Rectangle,V=Phaser.Math.Vector2,C=Phaser.Math.RotateAround,B=void 0,L=function(e,t,i){return void 0===t?t=new V:!0===t&&(void 0===W&&(W=new V),t=W),e.getTopLeft?e.getTopLeft(t):(t.x=e.x-Y(e)*e.originX,t.y=e.y-R(e)*e.originY,A(e,t,i))},U=function(e,t,i){return void 0===t?t=new V:!0===t&&(void 0===W&&(W=new V),t=W),e.getTopRight?e.getTopRight(t):(t.x=e.x-Y(e)*e.originX+Y(e),t.y=e.y-R(e)*e.originY,A(e,t,i))},D=function(e,t,i){return void 0===t?t=new V:!0===t&&(void 0===W&&(W=new V),t=W),e.getBottomLeft?e.getBottomLeft(t):(t.x=e.x-Y(e)*e.originX,t.y=e.y-R(e)*e.originY+R(e),A(e,t,i))},I=function(e,t,i){return void 0===t?t=new V:!0===t&&(void 0===W&&(W=new V),t=W),e.getBottomRight?e.getBottomRight(t):(t.x=e.x-Y(e)*e.originX+Y(e),t.y=e.y-R(e)*e.originY+R(e),A(e,t,i))},W=void 0,A=function(e,t,i){void 0===i&&(i=!1),0!==e.rotation&&C(t,e.x,e.y,e.rotation),i&&e.parentContainer&&e.parentContainer.getBoundsTransformMatrix().transformPoint(t.x,t.y,t);return t},z=Phaser.Geom.Rectangle,H=Phaser.Geom.Rectangle.Union,Q=Phaser.Utils.Objects.GetValue,E=Phaser.GameObjects.RenderTexture,N=Phaser.Utils.Objects.IsPlainObject,F=Phaser.Utils.Objects.GetValue,q=function(){o(h,P);var u=l(h);function h(e,t,i,n,r,o){var s;c(this,h),N(t)&&(t=F(o=t,"x",0),i=F(o,"y",0),n=F(o,"width",32),r=F(o,"height",32));var a=new E(e,t,i,n,r).setOrigin(.5);return(s=u.call(this,e,t,i,a.texture.key,null,o)).type="rexQuadRenderTexture",s.rt=a,s}return r(h,[{key:"destroy",value:function(e){f(s(h.prototype),"destroy",this).call(this,e),this.rt.destroy(),this.rt=null}},{key:"snapshot",value:function(e,t){return void 0===t&&(t={}),t.gameObjects=e,t.renderTexture=this.rt,T(t),this.width===this.frame.realWidth&&this.height===this.frame.realHeight||this.syncSize(),this}}]),h}();function J(e,t,i,n,r){var o=new q(this.scene,e,t,i,n,r);return this.scene.add.existing(o),o}var K=Phaser.Utils.Objects.GetAdvancedValue,Z=Phaser.GameObjects.BuildGameObject;function $(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=K(e,"x",0),n=K(e,"y",0),r=K(e,"width",32),o=K(e,"height",32),s=new q(this.scene,i,n,r,o,e);return Z(this.scene,s,e),s}function ee(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0);for(var n=.5*e.width,r=.5*e.height,o=Math.tan(t)*r,s=Math.tan(i)*n,a=e.controlPoints,u=0,h=a.length;u<h;u++){var c=a[u],l=c.localXOrigin,f=c.localYOrigin;c.localX=l+(r<f?o:-o),c.localY=f+(n<l?s:-s)}}var te=Phaser.Utils.Objects.IsPlainObject,ie=Phaser.Utils.Objects.GetValue,ne=Phaser.Math.DegToRad,re=Phaser.Math.RadToDeg,oe=function(){o(u,P);var a=l(u);function u(e,t,i,n,r){var o;if(c(this,u),te(t)){var s=t;t=ie(s,"x",0),i=ie(s,"y",0),n=ie(s,"key",null),r=ie(s,"frame",null)}return(o=a.call(this,e,t,i,n,r)).type="rexSkewmage",o._skewX=0,o._skewY=0,o}return r(u,[{key:"skewX",get:function(){return this._skewX},set:function(e){this._skewX=e,ee(this,this._skewX,this._skewY)}},{key:"skewXDeg",get:function(){return re(this._skewX)},set:function(e){this.skewX=ne(e)}},{key:"skewY",get:function(){return this._skewY},set:function(e){this._skewY=e,ee(this,this._skewX,this._skewY)}},{key:"skewYDeg",get:function(){return re(this._skewY)},set:function(e){this.skewY=ne(e)}},{key:"setSkewX",value:function(e){return this.skewX=e,this}},{key:"setSkewY",value:function(e){return this.skewY=e,this}},{key:"setSkew",value:function(e,t){return void 0===t&&(t=e),this.skewX=e,this.skewY=t,this}},{key:"setSkewXDeg",value:function(e){return this.skewXDeg=e,this}},{key:"setSkewYDeg",value:function(e){return this.skewYDeg=e,this}},{key:"setSkewDeg",value:function(e,t){return void 0===t&&(t=e),this.skewXDeg=e,this.skewYDeg=t,this}}]),u}();function se(e,t,i,n){var r=new oe(this.scene,e,t,i,n);return this.scene.add.existing(r),r}var ae=Phaser.Utils.Objects.GetAdvancedValue,ue=Phaser.GameObjects.BuildGameObject;function he(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=ae(e,"key",null),n=ae(e,"frame",null),r=new oe(this.scene,0,0,i,n);return ue(this.scene,r,e),r}var ce=Phaser.GameObjects.RenderTexture,le=Phaser.Utils.Objects.IsPlainObject,fe=Phaser.Utils.Objects.GetValue,de=function(){o(h,oe);var u=l(h);function h(e,t,i,n,r){var o;if(c(this,h),le(t)){var s=t;t=fe(s,"x",0),i=fe(s,"y",0),n=fe(s,"width",32),r=fe(s,"height",32)}var a=new ce(e,t,i,n,r).setOrigin(.5);return(o=u.call(this,e,t,i,a.texture.key,null)).type="rexSkewRenderTexture",o.rt=a,o}return r(h,[{key:"destroy",value:function(e){f(s(h.prototype),"destroy",this).call(this,e),this.rt.destroy(),this.rt=null}}]),h}();function ve(e,t,i,n){var r=new de(this.scene,e,t,i,n);return this.scene.add.existing(r),r}var ye=Phaser.Utils.Objects.GetAdvancedValue,ge=Phaser.GameObjects.BuildGameObject;function pe(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=ye(e,"x",0),n=ye(e,"y",0),r=ye(e,"width",32),o=ye(e,"height",32),s=new de(this.scene,i,n,r,o);return ge(this.scene,s,e),s}function we(e,t){if(e){for(var i=t.visibleSibling,n=0,r=i.length;n<r;n++)e.setChildVisible(i[n],!0);return i.length=0,e.setChildVisible(t,!1),t.isRunning=!1,1}}function xe(e){return function(){o(u,e);var a=l(u);function u(e,t){var i;c(this,u);var n,r,o,s=e.scene;return i=a.call(this,s,0,0,1,1,t),s.add.existing(h(i)),n=e,r=h(i),o=t,r.visibleSibling=[],r.isRunning=!1,r.useParentBounds=ke(o,"useParentBounds",!1),r.setPosition(n.x,n.y).setVisible(!1),n.pin(r),i}return r(u,[{key:"destroy",value:function(e){this.scene&&(this.exit(),f(s(u.prototype),"destroy",this).call(this,e))}},{key:"enter",value:function(){return function(e,t){if(!e)return!1;we(e,t);var i=t.useParentBounds;T({gameObjects:e.getAllVisibleChildren(),renderTexture:t.rt,x:t.x,y:t.y,width:i?e.displayWidth:void 0,height:i?e.displayHeighth:void 0,originX:i?e.originX:void 0,originY:i?e.originY:void 0}),e.setChildVisible(t,!0);for(var n=t.visibleSibling,r=e.children,o=0,s=r.length;o<s;o++){var a=r[o];a.visible&&a!==t&&(e.setChildVisible(a,!1),n.push(a))}return t.isRunning=!0}(this.rexContainer.parent,this)&&this.syncSize(),this}},{key:"exit",value:function(){return we(this.rexContainer.parent,this),this}}]),u}()}function be(e){return null==e||""===e||0===e.length}function me(e,t,i,n){if(void 0===n&&(n="."),"object"===u(e)){if(be(t)){if(null==i)return;"object"===u(i)&&(e=i)}else{"string"==typeof t&&(t=t.split(n));var r=t.pop();(function(e,t,i){var n=e;if(!be(t)){var r;"string"==typeof t&&(t=t.split("."));for(var o=0,s=t.length;o<s;o++){var a;if(null==n[r=t[o]]||"object"!==u(n[r]))a=o!==s-1||void 0===i?{}:i,n[r]=a;n=n[r]}}return n})(e,t)[r]=i}return e}}var ke=Phaser.Utils.Objects.GetValue,Pe=function(){o(t,xe(de));var e=l(t);function t(){return c(this,t),e.apply(this,arguments)}return r(t,[{key:"skewState",get:function(){return this.isRunning}}]),t}(),Oe=function(){o(n,Phaser.Plugins.BasePlugin);var i=l(n);function n(e){var t;return c(this,n),t=i.call(this,e),e.registerGameObject("rexQuadImage",a,X),e.registerGameObject("rexQuadRenderTexture",J,$),e.registerGameObject("rexSkewImage",se,he),e.registerGameObject("rexSkewRenderTexture",ve,pe),t}return r(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"addContainerSkew",value:function(e,t){return new Pe(e,t)}}]),n}();return me(window,"RexPlugins.GameObjects.QuadImage",P),me(window,"RexPlugins.GameObjects.QuadRenderTexture",q),me(window,"RexPlugins.GameObjects.SkewImage",oe),me(window,"RexPlugins.GameObjects.SkewRenderTexture",de),me(window,"RexPlugins.GameObjects.ContainerSkew",Pe),Oe});
